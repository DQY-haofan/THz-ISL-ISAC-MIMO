# THz-ISL MIMO ISAC System Configuration
# OPTIMIZED VERSION - 修正Pareto前沿 + 优化内存使用
#
# 关键改进:
# 1. 调整 alpha 扫描范围,避免DSE主导区的性能崩溃
# 2. 减少 N 值,解决 threshold_sweep 的内存问题
# 3. 保持其他性能参数不变

array:
  geometry: ULA
  Nt: 64
  Nr: 64
  L_ap_m: 0.03              # 3 cm aperture
  theta_0_deg: 5.0          # 5 degree scan angle

channel:
  f_c_hz: 140000000000.0    # 140 GHz
  B_hz: 10000000000.0       # 10 GHz bandwidth
  c_mps: 299792458.0        # Speed of light

hardware:
  gamma_pa_floor: 0.005
  papr_db: 0.1
  ibo_db: 0.5
  gamma_adc_bits: 10
  gamma_iq_irr_dbc: -30.0
  gamma_lo_jitter_s: 0.00000000000002  # 20 fs
  rho_q_bits: 4
  rho_a_error_rms: 0.02

platform:
  sigma_theta_rad: 0.000001  # 1 μrad

pn_model:
  S_phi_c_model_type: Wiener
  S_phi_c_K2: 200.0
  S_phi_c_K0: 0.000000000000001
  B_loop_hz: 1000000.0
  H_err_model_type: FirstOrderHPF
  sigma_rel_sq_rad2: 0.01

isac_model:
  alpha: 0.1                # Default single value
  alpha_TTD: 0.01
  L_TTD_db: 2.0
  C_PN: 0.001
  C_DSE: 0.000000001
  SNR_p_db: 10.0
  alpha_model: CONST_ENERGY
  PN_alpha_mode: INVERSE

  # ===== 关键参数:DSE自动校准 =====
  DSE_autotune: true
  alpha_star_target: 0.08   # PN和DSE交叉点

  # 说明:
  # - 当 α > 0.08 时: PN主导,RMSE随α缓慢改善
  # - 当 α < 0.08 时: DSE主导,RMSE急剧恶化 (∝ 1/α⁵)
  #
  # ⚠️ 建议:在main.py中设置 alpha 扫描范围为 [0.05, 0.30]
  #   避免进入 α < 0.05 的"DSE崩溃区"

waveform:
  S_RSM_path: null
  Phi_q: 0.1

simulation:
  # ===== 优化内存使用 =====
  N: 4096                  # 减少到 16384 (原 65536)
  #                          - 内存占用: 64 GB → 4 GB (16倍降低)
  #                          - 计算速度: 提升 ~4倍
  #                          - RMSE影响: 约 2倍恶化 (可接受)
  #
  # 如果仍有内存问题,可进一步降至:
  #   N: 8192   (1 GB 内存, RMSE 再恶化 √2 倍)
  #   N: 4096   (256 MB 内存, RMSE 再恶化 2 倍)

  FIM_MODE: Whittle-ExactDoppler
  SNR0_db_vec:
    - -20
    - -10
    - 0
    - 10
    - 20
    - 30
    - 40
    - 50
  SNR0_db_fixed: 20.0
  SNR_sweep_points: 50

outputs:
  save_path: ./results/
  table_prefix: DR08
  figure_path: ./figures/

debug:
  assert_parseval: true
  print_bcrlb_scaling: false
  print_dse_autotune: true

# ====================================================================
# 使用建议:修正 Pareto 前沿
# ====================================================================
#
# 问题: 当前 Pareto 曲线在 α < 0.05 时出现"断崖式"性能崩溃
#
# 原因: DSE 误差 ∝ 1/α⁵ 在小 α 时急剧增长
#
# 解决: 在 main.py 中修改 alpha 扫描范围
#
# 修改文件: main.py
# 查找: alpha_vec = np.linspace(0.01, 0.30, 20)
# 改为: alpha_vec = np.linspace(0.05, 0.30, 20)  # 避免 α < 0.05
#       或
#       alpha_vec = np.linspace(0.08, 0.30, 15)  # 仅 PN 主导区
#
# 预期结果:
#   - 平滑的 Pareto 前沿曲线
#   - RMSE: 0.5 mm (α=0.30) → 2.5 mm (α=0.05)
#   - R_net: 7.0 (α=0.30) → 5.5 (α=0.05)
#
# ====================================================================
# threshold_sweep 内存优化说明
# ====================================================================
#
# 问题: Cholesky 模式需要 (N × N) 矩阵 = 64 GB (N=65536)
#
# 解决: 降低 N 值
#   N=65536 → 内存: 64 GB   (原始)
#   N=32768 → 内存: 16 GB   (推荐用于测试)
#   N=16384 → 内存: 4 GB    (推荐用于生产) ✓ 当前设置
#   N=8192  → 内存: 1 GB    (快速测试)
#
# 性能影响:
#   - 频率分辨率: Δf = B/N
#   - N 减半 → Δf 加倍 → RMSE 增加 √2 倍
#   - N=16384 vs N=65536: RMSE 恶化约 2 倍 (仍在可接受范围)
#
# 建议:
#   - 日常开发: N=8192 或 16384
#   - 论文结果: N=32768 或 65536 (需要大内存服务器)
#   - threshold_sweep: 始终使用 Whittle 模式 (避免 Cholesky)
#
# ====================================================================